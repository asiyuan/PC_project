<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="css/index.css">
    <script src="js/gua.js"></script>
</head>
<body>
<!--外层包裹器-->
<div class="wrap">
    <!--开机遮罩层-->
    <div id="mask">
        <div class="maskUp"></div>
        <div class="maskDown"></div>
        <div class="maskLine"></div>
    </div>
    <!--头部-->
    <header id="header">
        <!--版心-->
        <div class="main">
            <!--logo区域-->
            <h1 class="logo">
                <a href="javascript:;">
                    <img src="img/logo.png">
                </a>
            </h1>
            <!--音乐播放-->
            <div class="music">
                <audio src="img/hotel.mp3"></audio>
            </div>
            <!--导航条-->
            <div class="nav">
                <ul class="navList clearfix">
                    <li>
                        <div class="up">
                            <img src="img/home_gruen.png">
                        </div>
                        <div class="down">
                            <img src="img/home.png">
                        </div>
                    </li>
                    <li>
                        <div class="up">Course</div>
                        <div class="down">Course</div>
                    </li>
                    <li>
                        <div class="up">Works</div>
                        <div class="down">Works</div>
                    </li>
                    <li>
                        <div class="up">About</div>
                        <div class="down">About</div>
                    </li>
                    <li>
                        <div class="up">Team</div>
                        <div class="down">Team</div>
                    </li>
                </ul>
            </div>
        </div>
        <!--箭头-->
        <div class="arrow"></div>
    </header>
    <!--内容-->
    <section id="content">
        <ul class="C_list">
            <!--第一屏-->
            <li class="home">
                <div>
                    <ul class="homeList">
                        <li class="active">
                            <div class="commonTitle">first page</div>
                        </li>
                        <li class="">
                            <div class="commonTitle">second page</div>
                        </li>
                        <li>
                            <div class="commonTitle">third page</div>
                        </li>
                        <li>
                            <div class="commonTitle">fouth page</div>
                        </li>
                    </ul>
                    <ul class="smallDot clearfix">
                        <li class="active"></li>
                        <li></li>
                        <li></li>
                        <li></li>
                    </ul>
                </div>
            </li>
            <!--第二屏-->
            <li class="course">
                <div>
                    <div class="course_1">
                        <p class="commonTitle">EINIGE</p>
                        <p class="commonTitle">UNSERER</p>
                        <p class="commonTitle">KUNDEN</p>
                    </div>
                    <div class="course_2">
                        <p class="commonText">Das Kundenvertrauen in unsere Kompetenz ist die notwendige Basis einer
                            erfolgreichen Zusammenarbeit, gleichzeitig aber auch das größte Lob, das man uns
                            entgegenbringen kann. </p>
                        <p class="commonText">Diese und viele weitere große und kleine Kunden vertrauen uns seit Jahren,
                            was uns stolz macht, und dafür sagen wir an dieser Stelle einfach mal.</p>
                    </div>
                    <div class="course_3">
                        <div class="cor3Item">
                            <div class="front"></div>
                            <div class="back">武装你的应该是知识</div>
                        </div>
                        <div class="cor3Item">
                            <div class="front"></div>
                            <div class="back">武装你的应该是知识</div>
                        </div>
                        <div class="cor3Item">
                            <div class="front"></div>
                            <div class="back">武装你的应该是知识</div>
                        </div>
                        <div class="cor3Item">
                            <div class="front"></div>
                            <div class="back">武装你的应该是知识</div>
                        </div>
                        <div class="cor3Item">
                            <div class="front"></div>
                            <div class="back">武装你的应该是知识</div>
                        </div>
                        <div class="cor3Item">
                            <div class="front"></div>
                            <div class="back">武装你的应该是知识</div>
                        </div>
                        <div class="cor3Item">
                            <div class="front"></div>
                            <div class="back">武装你的应该是知识</div>
                        </div>
                        <div class="cor3Item">
                            <div class="front"></div>
                            <div class="back">武装你的应该是知识</div>
                        </div>
                        <div class="cor3Item">
                            <div class="front"></div>
                            <div class="back">武装你的应该是知识</div>
                        </div>
                        <div class="cor3Item">
                            <div class="front"></div>
                            <div class="back">武装你的应该是知识</div>
                        </div>
                        <div class="cor3Item">
                            <div class="front"></div>
                            <div class="back">武装你的应该是知识</div>
                        </div>
                        <div class="cor3Item">
                            <div class="front"></div>
                            <div class="back">武装你的应该是知识</div>
                        </div>
                    </div>
                    <div class="plane_1"></div>
                    <div class="plane_2"></div>
                    <div class="plane_3"></div>
                </div>
            </li>
            <!--第三屏-->
            <li class="works">
                <div>
                    <div class="letter">
                        <p class="commonTitle">MY GIRLFRIEND</p>
                        <P class="commonTitle">I WILL FALL</P>
                        <p class="commonTitle">FOREVER</p>
                    </div>
                    <div class="pic clearfix">
                        <div class="picItem">
                            <img src="img/worksimg1.jpg">
                            <div class="mask">
                                <span>爱马仕·巴黎世家·卡地亚</span>
                                <div class="icon"></div>
                            </div>
                        </div>
                        <div class="picItem">
                            <img src="img/worksimg2.jpg">
                            <div class="mask">
                                <span class="commonText">爱马仕·巴黎世家·卡地亚</span>
                                <div class="icon"></div>
                            </div>
                        </div>
                        <div class="picItem">
                            <img src="img/worksimg3.jpg">
                            <div class="mask">
                                <span>爱马仕·巴黎世家·卡地亚</span>
                                <div class="icon"></div>
                            </div>
                        </div>
                        <div class="picItem">
                            <img src="img/worksimg4.jpg">
                            <div class="mask">
                                <span>爱马仕·巴黎世家·卡地亚</span>
                                <div class="icon"></div>
                            </div>
                        </div>
                    </div>
                    <div class="robot"></div>
                    <div class="pencil_1"></div>
                    <div class="pencil_2"></div>
                    <div class="pencil_3"></div>
                </div>
            </li>
            <!--第四屏-->
            <li class="about">
                <div>
                    <div class="about_1">
                        <p class="commonTitle">EINBLICK</p>
                        <p class="commonTitle">MY HEART WILL</p>
                        <p class="commonTitle">I AM YOURS</p>
                    </div>
                    <div class="about_2">
                        <p class="commonText">Der bunte Medienmix ist die Faszination die uns antreibt und das, was man
                            an uns schätzt. Von A bis Z und von vorne bis hinten nehmen wir Ihr Projekt unter unsere
                            Fittiche und lassen es zu etwas Großartigem heranwachsen.</p>
                    </div>
                    <div class="about_3">
                        <img src="img/about2.jpg">
                        <div class="a_mask">
                            <ul>
                                <li>
                                    <img src="img/about1.jpg">
                                </li>
                                <li>
                                    <img src="img/about1.jpg">
                                </li>
                                <li>
                                    <img src="img/about1.jpg">
                                </li>
                                <li>
                                    <img src="img/about1.jpg">
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="about_4">
                        <img src="img/about3.jpg">
                        <div class="a_mask">
                            <ul>
                                <li>
                                    <img src="img/about4.jpg">
                                </li>
                                <li>
                                    <img src="img/about4.jpg">
                                </li>
                                <li>
                                    <img src="img/about4.jpg">
                                </li>
                                <li>
                                    <img src="img/about4.jpg">
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </li>
            <!--第五屏-->
            <li class="team">
                <div>
                    <div class="team1">
                        <p class="commonTitle">PYTHON</p>
                        <p class="commonTitle">JAVASCRIPT</p>
                    </div>
                    <div class="team2">
                        <p class="commonText">Wir sind seit 2002 eine Full-Service-Werbeagentur mit Stammsitz in
                            Heimsheim, zwischen Stuttgart und Karlsruhe.</p>
                        <p class="commonText">Über 60 Jahre Erfahrung vereinen das gesamte VoxelAir-Team. Dabei hat
                            jedes Voxel neben professionellem Allroundwissen auch sein ganz spezielles Gebiet, um selbst
                            die individuellsten Kundenwünsche schnell und kompetent umzusetzen.</p>
                    </div>
                    <div class="team3">
                        <ul class="clearfix">
                            <li></li>
                            <li></li>
                            <li></li>
                            <li></li>
                        </ul>
                    </div>
                </div>
            </li>
        </ul>
        <ul class="menuBar">
            <li class="active"></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
        </ul>
    </section>
</div>
</body>
<script src="js/utils.js"></script>
<script>
    var navLis = document.querySelectorAll("#header .main .nav li")
    var upNavs = document.querySelectorAll("#header .main .nav li .up")
    var arrow = document.querySelector('.arrow')
    var content = document.querySelector("#content")
    var conLis = document.querySelectorAll(".C_list>li")
    var conList = document.querySelector(".C_list")
    var menuBars = getAllE(".menuBar>li")

    // 页面切换的索引
    var index = 0
    var timeId = null;

    // 设置 content 和 每一页的 height
    (function () {
        var content = document.querySelector("#content")
        var conLis = document.querySelectorAll(".C_list>li")
        content.style.height = document.documentElement.clientHeight - header.offsetHeight + 'px'
        for (var i = 0; i < conLis.length; i++) {
            conLis[i].style.height = document.documentElement.clientHeight - header.offsetHeight + 'px'
        }
    })()

    // 头部部分绑定
    var headerBind = function () {
        upNavs[index].style.width = '100%'
        arrow.style.left = navLis[index].getBoundingClientRect().left + navLis[0].offsetWidth / 2 + 'px'

        // 初始化主体部分
        for (var i = 0; i < navLis.length; i++) {
            navLis[i].index = i
            navLis[i].onclick = function () {
                // 重置 index， 让 滚轮的 index 和 点击的 index 统一
                animationArr[index].outAnimation()
                animationArr[this.index].inAnimation()
                window.index = this.index
                switchPage(this.index)
                menuBars[this.index].className = 'active'
            }
        }
    }

    // 主体内容移动
    var switchPage = function (index) {
        for (var j = 0; j < navLis.length; j++) {
            upNavs[j].style.width = ''
        }
        upNavs[index].style.width = '100%'
        arrow.style.left = navLis[index].getBoundingClientRect().left + navLis[index].offsetWidth / 2 + 'px'
        conList.style.top = -index * (document.documentElement.clientHeight - header.offsetHeight) + 'px'

        // 清除侧边样式
        for (var i = 0; i < menuBars.length; i++) {
            menuBars[i].className = ''
        }
        this.className = 'active'
    }

    // 侧边导航
    var bindMenuBar = function () {
        for (var i = 0; i < menuBars.length; i++) {
            // 保存索引
            menuBars[i].index = i
            bindEvent(menuBars[i], 'click', function () {
                animationArr[index].outAnimation()
                animationArr[this.index].inAnimation()
                index = this.index
                switchPage(this.index)
                this.className = 'active'
            })
        }
    }

    var callback = {
        'wheelUp': function () {
            if (index > 0) {
                animationArr[index].outAnimation()
                index--
                animationArr[index].inAnimation()
                switchPage(index)
                menuBars[index].className = 'active'
            }
        },
        'wheelDown': function () {
            if (index < 4) {
                animationArr[index].outAnimation()
                index++
                animationArr[index].inAnimation()
                switchPage(index)
                menuBars[index].className = 'active'
            }
        }
    }

    // 第一屏的逻辑
    var bannerSwitch = function () {
        var smallDots = getAllE(".smallDot>li")
        var bannerLis = getAllE(".homeList>li")
        var oldindex = 0
        var index = 0
        var timeId = null
        var isMoving = false
        for (var i = 0; i < smallDots.length; i++) {
            var ele = smallDots[i]
            ele.dataset.id = i
            ele.addEventListener("click", function () {
                clearInterval(timeId)
                if (isMoving) {
                    return
                }
                autoBanner()
                for (var j = 0; j < smallDots.length; j++) {
                    smallDots[j].classList.remove("active")
                }
                index = parseInt(this.dataset.id)
                this.classList.add("active")
                if (oldindex < index) {
                    isMoving = true
                    bannerLis[oldindex].className = 'leftHide'
                    bannerLis[index].className = 'rightShow'
                    setTimeout(function () {
                        isMoving = false
                    }, 1500)
                } else if (oldindex > index) {
                    isMoving = true
                    bannerLis[index].className = 'leftShow'
                    bannerLis[oldindex].className = 'rightHide'
                    setTimeout(function () {
                        isMoving = false
                    }, 1500)
                }
                oldindex = index
            })
        }

         autoBanner = function () {
            timeId = setInterval(function () {
                index = oldindex + 1
                if (index > 3) {
                    index = 0
                }
                bannerLis[oldindex].className = 'leftHide'
                bannerLis[index].className = 'rightShow'

                // 小圆点逻辑
                for (var i = 0; i < smallDots.length; i++) {
                    smallDots[i].className = ''
                }
                smallDots[index].className = 'active'
                oldindex = index
            }, 3000)
        }

    }

    var imageBubblt = function () {
        var teaLis = getAllE(".team3 li")
        var team3 = e(".team3")
        var myCanvas = null

        // 鼠标移入
        for (var i = 0; i < teaLis.length; i++) {
            var li = teaLis[i]
            li.index = i
            li.addEventListener('mouseenter', function () {
                if (!myCanvas) {
                    var canvas = new Canvas(236, 310, 'rgba(255,255,255,0)')
                    myCanvas = canvas.init()
                    myCanvas.style.top = 0
                    team3.appendChild(myCanvas)
                    var arr = canvas.initBubblt()
                    canvas.drawImage(myCanvas, arr)
                }

                for (var j = 0; j < teaLis.length; j++) {
                    teaLis[j].style.opacity = 0.3
                }
                this.style.opacity = 1
                myCanvas.style.left = teaLis[0].offsetWidth * this.index + 'px'
            })
        }

        // 鼠标移出
        bindEvent(team3, 'mouseleave', function () {
            for (var i = 0; i < teaLis.length; i++) {
                teaLis[i].style.opacity = 0.3
            }
            myCanvas.remove()
            myCanvas = null
        })
        /*for (var i = 0; i < teaLis.length; i++) {
         bindEvent(teaLis[i], 'mouseleave', function () {
         log(11)
         teaLis[i].style.opacity = '0.3'
         })
         }*/
    }

    // 音频
    var switchMusic = function () {
        var musicDiv = e(".music")
        var myAudio = e('audio')
        musicDiv.onclick = function () {
            if (myAudio.paused) {
                myAudio.play()
                musicDiv.style.backgroundImage = 'url("img/musicon.gif")'
            } else {
                myAudio.pause()
                musicDiv.style.backgroundImage = 'url("img/musicoff.gif")'
            }
        }
    }


    for (var i = 0; i < animationArr.length; i++) {
        log(i)
        animationArr[i].outAnimation()
    }



    // 开机动画
    var mask = document.querySelector("#mask")
    var maskUp = document.querySelector(".maskUp")
    var maskDown = document.querySelector(".maskDown")
    var maskLine = document.querySelector(".maskLine")
    var loaded = 0
    var imgArr = ['bg1.jpg','bg2.jpg','bg3.jpg','bg4.jpg','bg5.jpg','about1.jpg','about2.jpg','about3.jpg','about4.jpg','worksimg1.jpg','worksimg2.jpg','worksimg3.jpg','worksimg4.jpg','team.png','greenLine.png'];
    for (var i = 0; i < imgArr.length; i++) {
        var img = new Image()
        img.src = 'img/' + imgArr[i]
        img.onload = function () {
            loaded++
            maskLine.style.width = loaded/imgArr.length * 100 + '%  '
        }
    }
    maskLine.addEventListener('transitionend', function () {
        maskUp.style.height = 0
        maskDown.style.height = 0
        maskLine.remove()
        animationArr[0].inAnimation()
    })
    maskUp.addEventListener('transitionend', function () {
        mask.remove()
        autoBanner()
    })

    // 响应页面缩放
    window.onresize = function () {
        headerBind()
        switchPage(index)
    }

    var __main = function () {
        headerBind()
        wheelBind(callback)
//        switchPage(index)
        bannerSwitch()
        imageBubblt()
        bindMenuBar()
        switchMusic()
    }

    __main()
</script>
</html>